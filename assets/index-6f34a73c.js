(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ue(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fe={},Y={},H={},_={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBlendMode={},t.toBlendMode={pass:"pass through",norm:"normal",diss:"dissolve",dark:"darken","mul ":"multiply",idiv:"color burn",lbrn:"linear burn",dkCl:"darker color",lite:"lighten",scrn:"screen","div ":"color dodge",lddg:"linear dodge",lgCl:"lighter color",over:"overlay",sLit:"soft light",hLit:"hard light",vLit:"vivid light",lLit:"linear light",pLit:"pin light",hMix:"hard mix",diff:"difference",smud:"exclusion",fsub:"subtract",fdiv:"divide","hue ":"hue","sat ":"saturation",colr:"color","lum ":"luminosity"},Object.keys(t.toBlendMode).forEach(function(e){return t.fromBlendMode[t.toBlendMode[e]]=e}),function(e){e[e.RGB=0]="RGB",e[e.HSB=1]="HSB",e[e.CMYK=2]="CMYK",e[e.Lab=7]="Lab",e[e.Grayscale=8]="Grayscale"}(t.ColorSpace||(t.ColorSpace={})),function(e){e[e.Bitmap=0]="Bitmap",e[e.Grayscale=1]="Grayscale",e[e.Indexed=2]="Indexed",e[e.RGB=3]="RGB",e[e.CMYK=4]="CMYK",e[e.Multichannel=7]="Multichannel",e[e.Duotone=8]="Duotone",e[e.Lab=9]="Lab"}(t.ColorMode||(t.ColorMode={})),function(e){e[e.Red=0]="Red",e[e.Green=1]="Green",e[e.Blue=2]="Blue",e[e.Transparency=-1]="Transparency",e[e.UserMask=-2]="UserMask",e[e.RealUserMask=-3]="RealUserMask"}(t.ChannelID||(t.ChannelID={})),function(e){e[e.RawData=0]="RawData",e[e.RleCompressed=1]="RleCompressed",e[e.ZipWithoutPrediction=2]="ZipWithoutPrediction",e[e.ZipWithPrediction=3]="ZipWithPrediction"}(t.Compression||(t.Compression={})),function(e){e[e.Other=0]="Other",e[e.OpenFolder=1]="OpenFolder",e[e.ClosedFolder=2]="ClosedFolder",e[e.BoundingSectionDivider=3]="BoundingSectionDivider"}(t.SectionDividerType||(t.SectionDividerType={}))})(_);var g={};Object.defineProperty(g,"__esModule",{value:!0});var E=_;function le(t){switch(t){case E.ChannelID.Red:return 0;case E.ChannelID.Green:return 1;case E.ChannelID.Blue:return 2;case E.ChannelID.Transparency:return 3;default:return t+1}}g.offsetForChannel=le;function de(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t[r];return e}g.toArray=de;function be(t){return de(t.readBytes(10))}g.readColor=be;function ce(t){for(var e=t.width*t.height,r=0;r<e;r++)if(t.data[r*4+3]!==255)return!0;return!1}g.hasAlpha=ce;function Ie(t){var e=0,r=0,n=t.width,i=t.height;function a(f,l){return t.data[(l*t.width+f)*4+3]===0}function o(f){for(var l=r;l<n;l++)if(!a(l,f))return!1;return!0}function s(f){for(var l=e;l<i;l++)if(!a(f,l))return!1;return!0}for(;e<i&&o(e);)e++;for(;i>e&&o(i-1);)i--;for(;r<n&&s(r);)r++;for(;n>r&&s(n-1);)n--;return{top:e,left:r,right:n,bottom:i}}function Ce(t,e){typeof t.top>"u"&&(t.top=0),typeof t.left>"u"&&(t.left=0),typeof t.right>"u"&&(t.right=t.canvas?t.canvas.width:t.left),typeof t.bottom>"u"&&(t.bottom=t.canvas?t.canvas.height:t.top);var r=t.canvas,n=t.right-t.left,i=t.bottom-t.top,a=[{channelId:E.ChannelID.Transparency,compression:E.Compression.RawData,buffer:void 0,length:2}];if(!r||!n||!i)return a;var o=r.getContext("2d"),s=o.getImageData(t.left,t.top,n,i),f=Ie(s),l=f.left,d=f.top,c=f.right,u=f.bottom;if(l!==0||d!==0||c!==s.width||u!==s.height){if(t.left+=l,t.top+=d,t.right-=s.width-c,t.bottom-=s.height-u,n=t.right-t.left,i=t.bottom-t.top,!n||!i)return a;s=o.getImageData(t.left,t.top,n,i)}a=[];var h=[E.ChannelID.Red,E.ChannelID.Green,E.ChannelID.Blue];(!e||n!==r.width||i!==r.height||ce(s))&&h.unshift(E.ChannelID.Transparency);for(var v=0,y=h;v<y.length;v++){var C=y[v],p=le(C),I=he(s,n,i,[p]);a.push({channelId:C,compression:E.Compression.RleCompressed,buffer:I,length:2+I.length})}return a}g.getChannels=Ce;function Se(t){for(var e=t.width*t.height*4,r=0;r<e;)t.data[r++]=0,t.data[r++]=0,t.data[r++]=0,t.data[r++]=255}g.resetCanvas=Se;function Ee(t,e,r,n){for(var i=0,a=0,o=0;i<n;i++)for(var s=0;s<r;)for(var f=t[o++],l=0;l<8&&s<r;l++,s++){var d=f&128?0:255;f=f<<1,e[a++]=d,e[a++]=d,e[a++]=d,e[a++]=255}}g.decodeBitmap=Ee;function ke(t,e,r,n){if(!(!r||!n)){for(var i=new Uint8Array(r*n),a=0;a<i.length;a++)i[a]=t.data[a*4+e];return i}}g.writeDataRaw=ke;function Pe(t,e,r,n,i){var a=n*i,o=t.readBytes(a);if(e&&r<4)for(var s=0;s<a;s++)e.data[s*4+r]=o[s]}g.readDataRaw=Pe;function he(t,e,r,n){if(!(!e||!r)){for(var i=t.data,a=[],o=0,s=0;s<n.length;s++){for(var f=[],l=[],d=n[s],c=0,u=0;c<r;c++,u+=e){for(var h=[],v=0,y=-1,C=i[u*4+d],p=1,I=!1,R=1;R<e;R++){var k=i[(u+R)*4+d];p===2&&(I=C===k&&y===k),I&&C!==k?(v+=2,h.push(p),p=0,I=!1):!I&&p>2&&k===C&&k===y?(v+=p-1,h.push(p-2),p=2,I=!0):p===128&&(v+=I?2:p+1,h.push(p),p=0,I=!1),y=C,C=k,p++}v+=I?2:1+p,h.push(p),l.push(h),f.push(v),o+=2+v}a.push({lengths:f,lines:l,offset:d})}for(var B=new Uint8Array(o),L=0,$=0,X=a;$<X.length;$++)for(var N=X[$],V=0,Q=N.lengths;V<Q.length;V++){var ee=Q[V];B[L++]=ee>>8&255,B[L++]=ee&255}for(var Z=0,te=a;Z<te.length;Z++)for(var N=te[Z],c=0,u=0;c<r;c++,u+=e)for(var h=N.lines[c],d=N.offset,R=0,s=0;s<h.length;s++){var k=i[(u+R)*4+d],I=h[s]>2&&k===i[(u+R+1)*4+d]&&k===i[(u+R+2)*4+d];if(I)B[L++]=1-h[s],B[L++]=k;else{B[L++]=h[s]-1;for(var K=0;K<h[s];K++)B[L++]=i[(u+R+K)*4+d]}R+=h[s]}return B}}g.writeDataRLE=he;function Re(t,e,r,n,i,a){for(var o=[],s=0;s<a.length;s++){o[s]=[];for(var f=0;f<i;f++)o[s][f]=t.readUint16()}for(var s=0;s<a.length;s++)for(var l=o[s],d=s>3||a[s]>3,c=a[s],f=0;f<i;f++)for(var u=l[f],h=t.readBytes(u),v=0;v<u;v++){var y=h[v];if(y>=128){var C=h[++v];y=256-y;for(var p=0;p<=y;p++)e&&!d&&(e.data[c]=C),c+=r}else if(y<128)for(var p=0;p<=y;p++)v++,e&&!d&&(e.data[c]=h[v]),c+=r;if(v>=u)throw new Error("Exceeded buffer size "+v+"/"+u)}}g.readDataRLE=Re;var x={},T={};Object.defineProperty(T,"__esModule",{value:!0});var S=g;function O(t){return t.checkSignature("8BIM"),t.readSignature()}function re(t){var e=t.readUint32(),r=t.readUint32();if(e!==41&&e!==51)throw new Error("Invalid effects shadow info size: "+e);if(r!==0&&r!==2)throw new Error("Invalid effects shadow info version: "+r);var n=t.readInt32(),i=t.readInt32(),a=t.readInt32(),o=t.readInt32(),s=S.readColor(t),f=O(t),l=!!t.readUint8(),d=!!t.readUint8(),c=t.readUint8(),u=e>=51?S.readColor(t):void 0;return{blur:n,intensity:i,angle:a,distance:o,color:s,blendMode:f,enabled:l,useAngleInAllEffects:d,opacity:c,nativeColor:u}}function De(t){var e=t.readUint32(),r=t.readUint32();if(e!==32&&e!==42)throw new Error("Invalid effects outer glow info size: "+e);if(r!==0&&r!==2)throw new Error("Invalid effects outer glow info version: "+r);var n=t.readUint32(),i=t.readUint32(),a=S.readColor(t),o=O(t),s=!!t.readUint8(),f=t.readUint8(),l=e>=42?S.readColor(t):void 0;return{blur:n,intensity:i,color:a,blendMode:o,enabled:s,opacity:f,nativeColor:l}}function Me(t){var e=t.readUint32(),r=t.readUint32();if(e!==33&&e!==43)throw new Error("Invalid effects inner glow info size: "+e);if(r!==0&&r!==2)throw new Error("Invalid effects inner glow info version: "+r);var n=t.readUint32(),i=t.readUint32(),a=S.readColor(t),o=O(t),s=!!t.readUint8(),f=t.readUint8(),l=e>=43?!!t.readUint8():void 0,d=e>=43?S.readColor(t):void 0;return{blur:n,intensity:i,color:a,blendMode:o,enabled:s,opacity:f,invert:l,nativeColor:d}}function Be(t){var e=t.readUint32(),r=t.readUint32();if(e!==58&&e!==78)throw new Error("Invalid effects bevel info size: "+e);if(r!==0&&r!==2)throw new Error("Invalid effects bevel info version: "+r);var n=t.readUint32(),i=t.readUint32(),a=t.readUint32(),o=O(t),s=O(t),f=S.readColor(t),l=S.readColor(t),d=t.readUint8(),c=t.readUint8(),u=t.readUint8(),h=!!t.readUint8(),v=!!t.readUint8(),y=!!t.readUint8(),C=e>=78?S.readColor(t):void 0,p=e>=78?S.readColor(t):void 0;return{angle:n,strength:i,blur:a,highlightBlendMode:o,shadowBlendMode:s,highlightColor:f,shadowColor:l,bevelStyle:d,highlightOpacity:c,shadowOpacity:u,enabled:h,useAngleInAllEffects:v,up:y,realHighlightColor:C,realShadowColor:p}}function Le(t){var e=t.readUint32(),r=t.readUint32();if(e!==34)throw new Error("Invalid effects solid fill info size: "+e);if(r!==2)throw new Error("Invalid effects solid fill info version: "+r);var n=O(t),i=S.readColor(t),a=t.readUint8(),o=!!t.readUint8(),s=S.readColor(t);return{blendMode:n,color:i,opacity:a,enabled:o,nativeColor:s}}function Ae(t){var e=t.readUint16();if(e!==0)throw new Error("Invalid effects layer version: "+e);for(var r=t.readUint16(),n={},i=0;i<r;i++){t.checkSignature("8BIM");var a=t.readSignature();switch(a){case"cmnS":var o=t.readUint32(),s=t.readUint32(),f=!!t.readUint8();if(t.skip(2),o!==7||s!==0||!f)throw new Error("Invalid effects common state");break;case"dsdw":n.dropShadow=re(t);break;case"isdw":n.innerShadow=re(t);break;case"oglw":n.outerGlow=De(t);break;case"iglw":n.innerGlow=Me(t);break;case"bevl":n.bevel=Be(t);break;case"sofi":n.solidFill=Le(t);break;default:throw new Error("Invalid effect type: '"+a+"'")}}return n}T.readEffects=Ae;function Oe(t,e){throw new Error("Not implemented")}T.writeEffects=Oe;Object.defineProperty(x,"__esModule",{value:!0});var ne=T,ue=g,ve=[],pe={};function U(t){ve.push(t),pe[t.key]=t}function _e(t){return pe[t]}x.getHandler=_e;function xe(){return ve}x.getHandlers=xe;U({key:"luni",has:function(t){return typeof t.name<"u"},read:function(t,e,r){e.name=t.readUnicodeString(),t.skip(r())},write:function(t,e){t.writeUnicodeString(e.name)}});U({key:"lnsr",has:function(t){return typeof t.nameSource<"u"},read:function(t,e){return e.nameSource=t.readSignature()},write:function(t,e){return t.writeSignature(e.nameSource)}});U({key:"lyid",has:function(t){return typeof t.id<"u"},read:function(t,e){return e.id=t.readUint32()},write:function(t,e){return t.writeUint32(e.id)}});U({key:"clbl",has:function(t){return typeof t.blendClippendElements<"u"},read:function(t,e){e.blendClippendElements=!!t.readUint8(),t.skip(3)},write:function(t,e){t.writeUint8(e.blendClippendElements?1:0),t.writeZeros(3)}});U({key:"infx",has:function(t){return typeof t.blendInteriorElements<"u"},read:function(t,e){e.blendInteriorElements=!!t.readUint8(),t.skip(3)},write:function(t,e){t.writeUint8(e.blendInteriorElements?1:0),t.writeZeros(3)}});U({key:"knko",has:function(t){return typeof t.knockout<"u"},read:function(t,e){e.knockout=!!t.readUint8(),t.skip(3)},write:function(t,e){t.writeUint8(e.knockout?1:0),t.writeZeros(3)}});U({key:"lspf",has:function(t){return typeof t.protected<"u"},read:function(t,e){var r=t.readUint32();e.protected={transparency:(r&1)!==0,composite:(r&2)!==0,position:(r&4)!==0}},write:function(t,e){var r=(e.protected.transparency?1:0)|(e.protected.composite?2:0)|(e.protected.position?4:0);t.writeUint32(r)}});U({key:"lclr",has:function(t){return typeof t.sheetColors<"u"},read:function(t,e){e.sheetColors={color1:t.readUint32(),color2:t.readUint32()}},write:function(t,e){t.writeUint32(e.sheetColors.color1),t.writeUint32(e.sheetColors.color2)}});U({key:"fxrp",has:function(t){return typeof t.referencePoint<"u"},read:function(t,e){e.referencePoint={x:t.readFloat64(),y:t.readFloat64()}},write:function(t,e){t.writeFloat64(e.referencePoint.x),t.writeFloat64(e.referencePoint.y)}});U({key:"lsct",has:function(t){return typeof t.sectionDivider<"u"},read:function(t,e,r){var n={};if(n.type=t.readUint32(),r()){var i=t.readSignature();if(i!=="8BIM")throw new Error("Invalid signature: '"+i+"'");n.key=t.readSignature()}r()&&(n.subType=t.readUint32()),e.sectionDivider=n},write:function(t,e){t.writeUint32(e.sectionDivider.type),e.sectionDivider.key&&(t.writeSignature("8BIM"),t.writeSignature(e.sectionDivider.key),typeof e.sectionDivider.subtype<"u"&&t.writeUint32(e.sectionDivider.subtype))}});U({key:"FMsk",has:function(t){return typeof t.filterMask<"u"},read:function(t,e){e.filterMask={colorSpace:ue.readColor(t),opacity:t.readUint16()}},write:function(t,e){t.writeBytes(new Uint8Array(e.filterMask.colorSpace)),t.writeUint16(e.filterMask.opacity)}});U({key:"shmd",has:function(t){return typeof t.metadata<"u"},read:function(t,e){var r=t.readUint32();e.metadata=[];for(var n=0;n<r;n++){var i=t.readSignature();if(i!=="8BIM")throw new Error("Invalid signature: '"+i+"'");var a=t.readSignature(),o=!!t.readUint8();t.skip(3);var s=t.readUint32(),f=ue.toArray(t.readBytes(s));e.metadata.push({key:a,copy:o,data:f})}},write:function(t,e){t.writeUint32(e.metadata.length);for(var r=0;r<e.metadata.length;r++){var n=e.metadata[r];t.writeSignature("8BIM"),t.writeSignature(n.key),t.writeUint8(n.copy?1:0),t.writeZeros(3),t.writeUint32(n.data.length),t.writeBytes(new Uint8Array(n.data))}}});U({key:"lyvr",has:function(t){return typeof t.version<"u"},read:function(t,e){e.version=t.readUint32()},write:function(t,e){t.writeUint32(e.version)}});U({key:"lrFX",has:function(t){return typeof t.effects<"u"},read:function(t,e,r){e.effects=ne.readEffects(t),t.skip(r())},write:function(t,e){ne.writeEffects(t,e.effects)}});U({key:"lfx2",has:function(t){return typeof t.objectBasedEffectsLayerInfo<"u"},read:function(t,e,r){t.skip(r())},write:function(t,e){}});var G={};Object.defineProperty(G,"__esModule",{value:!0});var we=[],ye={};function b(t){we.push(t),ye[t.key]=t}function Ge(t,e){return ye[t]}G.getHandler=Ge;function Ne(){return we}G.getHandlers=Ne;function ie(t){return t.readUint32()/65536}function ae(t,e){t.writeUint32(e*65536)}var F=[void 0,"PPI","PPCM"],z=[void 0,"Inches","Centimeters","Points","Picas","Columns"];b({key:1005,has:function(t){return typeof t.resolutionInfo<"u"},read:function(t,e){var r=ie(t),n=t.readUint16(),i=t.readUint16(),a=ie(t),o=t.readUint16(),s=t.readUint16();e.resolutionInfo={horizontalResolution:r,horizontalResolutionUnit:F[n]||"PPI",widthUnit:z[i]||"Inches",verticalResolution:a,verticalResolutionUnit:F[o]||"PPI",heightUnit:z[s]||"Inches"}},write:function(t,e){var r=e.resolutionInfo;ae(t,r.horizontalResolution||0),t.writeUint16(Math.max(1,F.indexOf(r.horizontalResolutionUnit))),t.writeUint16(Math.max(1,z.indexOf(r.widthUnit))),ae(t,r.verticalResolution||0),t.writeUint16(Math.max(1,F.indexOf(r.verticalResolutionUnit))),t.writeUint16(Math.max(1,z.indexOf(r.heightUnit)))}});b({key:1006,has:function(t){return typeof t.alphaChannelNames<"u"},read:function(t,e,r){for(e.alphaChannelNames=[];r();)e.alphaChannelNames.push(t.readPascalString(1))},write:function(t,e){for(var r=0,n=e.alphaChannelNames;r<n.length;r++){var i=n[r];t.writePascalString(i)}}});b({key:1024,has:function(t){return typeof t.layerState<"u"},read:function(t,e){e.layerState=t.readUint16()},write:function(t,e){t.writeUint16(e.layerState)}});b({key:1026,has:function(t){return typeof t.layersGroup<"u"},read:function(t,e,r){for(e.layersGroup=[];r();)e.layersGroup.push(t.readUint16())},write:function(t,e){for(var r=0,n=e.layersGroup;r<n.length;r++){var i=n[r];t.writeUint32(i)}}});b({key:1032,has:function(t){return typeof t.gridAndGuidesInformation<"u"},read:function(t,e){e.gridAndGuidesInformation={version:t.readUint32(),grid:{horizontal:t.readUint32(),vertical:t.readUint32()},guides:[]};for(var r=t.readUint32();r--;)e.gridAndGuidesInformation.guides.push({location:t.readUint32()/32,direction:t.readUint8()?"horizontal":"vertical"})},write:function(t,e){var r=e.gridAndGuidesInformation,n=r.version||1,i=r.grid||{horizontal:18*32,vertical:18*32},a=r.guides||[];t.writeUint32(n),t.writeUint32(i.horizontal),t.writeUint32(i.vertical),t.writeUint32(a.length),a.forEach(function(o){t.writeUint32(o.location*32),t.writeUint8(o.direction==="horizontal"?1:0)})}});b({key:1037,has:function(t){return typeof t.globalAngle<"u"},read:function(t,e){e.globalAngle=t.readUint32()},write:function(t,e){t.writeUint32(e.globalAngle)}});b({key:1045,has:function(t){return typeof t.unicodeAlphaNames<"u"},read:function(t,e,r){for(e.unicodeAlphaNames=[];r();)e.unicodeAlphaNames.push(t.readUnicodeString())},write:function(t,e){for(var r=0,n=e.unicodeAlphaNames;r<n.length;r++){var i=n[r];t.writeUnicodeString(i)}}});b({key:1049,has:function(t){return typeof t.globalAltitude<"u"},read:function(t,e){e.globalAltitude=t.readUint32()},write:function(t,e){t.writeUint32(e.globalAltitude)}});b({key:1053,has:function(t){return typeof t.alphaIdentifiers<"u"},read:function(t,e,r){for(e.alphaIdentifiers=[];r()>=4;)e.alphaIdentifiers.push(t.readUint32())},write:function(t,e){for(var r=0,n=e.alphaIdentifiers;r<n.length;r++){var i=n[r];t.writeUint32(i)}}});b({key:1054,has:function(t){return typeof t.urlsList<"u"},read:function(t,e){var r=t.readUint32();if(e.urlsList=[],r)throw new Error("Not implemented: URL List")},write:function(t,e){if(t.writeUint32(e.urlsList.length),e.urlsList.length)throw new Error("Not implemented: URL List")}});b({key:1057,has:function(t){return typeof t.versionInfo<"u"},read:function(t,e){e.versionInfo={version:t.readUint32(),hasRealMergedData:!!t.readUint8(),writerName:t.readUnicodeString(),readerName:t.readUnicodeString(),fileVersion:t.readUint32()}},write:function(t,e){var r=e.versionInfo;t.writeUint32(r.version),t.writeUint8(r.hasRealMergedData?1:0),t.writeUnicodeString(r.writerName),t.writeUnicodeString(r.readerName),t.writeUint32(r.fileVersion)}});b({key:1064,has:function(t){return typeof t.pixelAspectRatio<"u"},read:function(t,e){e.pixelAspectRatio={version:t.readUint32(),aspect:t.readFloat64()}},write:function(t,e){t.writeUint32(e.pixelAspectRatio.version),t.writeFloat64(e.pixelAspectRatio.aspect)}});b({key:1069,has:function(t){return typeof t.layerSelectionIds<"u"},read:function(t,e){var r=t.readUint16();for(e.layerSelectionIds=[];r--;)e.layerSelectionIds.push(t.readUint32())},write:function(t,e){t.writeUint16(e.layerSelectionIds.length);for(var r=0,n=e.layerSelectionIds;r<n.length;r++){var i=n[r];t.writeUint32(i)}}});b({key:1072,has:function(t){return typeof t.layerGroupsEnabledId<"u"},read:function(t,e,r){for(e.layerGroupsEnabledId=[];r();)e.layerGroupsEnabledId.push(t.readUint8())},write:function(t,e){for(var r=0,n=e.layerGroupsEnabledId;r<n.length;r++){var i=n[r];t.writeUint8(i)}}});Object.defineProperty(H,"__esModule",{value:!0});var w=_,D=g,Fe=x,ze=G,oe=[w.ColorMode.Bitmap,w.ColorMode.Grayscale,w.ColorMode.RGB];function se(t){for(var e=t.width*t.height*4,r=0;r<e;r+=4)t.data[r+1]=t.data[r],t.data[r+2]=t.data[r]}var P="Not implemented",je=function(){function t(){this.offset=0}return t.prototype.readInt8=function(){throw new Error(P)},t.prototype.readUint8=function(){throw new Error(P)},t.prototype.readInt16=function(){throw new Error(P)},t.prototype.readUint16=function(){throw new Error(P)},t.prototype.readInt32=function(){throw new Error(P)},t.prototype.readUint32=function(){throw new Error(P)},t.prototype.readFloat32=function(){throw new Error(P)},t.prototype.readFloat64=function(){throw new Error(P)},t.prototype.readBytes=function(e){throw new Error(P)},t.prototype.createCanvas=function(e,r){throw new Error(P)},t.prototype.skip=function(e){this.offset+=e},t.prototype.readString=function(e){var r=this.readBytes(e);return String.fromCharCode.apply(String,r)},t.prototype.readSignature=function(){return this.readString(4)},t.prototype.readPascalString=function(e){e===void 0&&(e=2);for(var r=this.readUint8(),n=this.readString(r);++r%e;)this.skip(1);return n},t.prototype.readUnicodeString=function(){for(var e=this.readUint32(),r="";e--;)r+=String.fromCharCode(this.readUint16());return r},t.prototype.readSection=function(e,r){var n=this,i=this.readUint32(),a=this.offset+i,o;if(i>0&&(o=r(function(){return a-n.offset})),this.offset>a)throw new Error("Exceeded section limits");if(this.offset!==a)throw new Error("Unread section data: "+(a-this.offset)+" bytes at 0x"+this.offset.toString(16));for(;a%e;)a++;return this.offset=a,o},t.prototype.checkSignature=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=this.offset,i=this.readSignature();if(e.indexOf(i)===-1)throw new Error("Invalid signature: '"+i+"' at 0x"+n.toString(16))},t.prototype.readPsd=function(e){var r=e||{},n=this.readHeader();this.readColorModeData(n),this.readImageResources(n);var i=this.readLayerAndMaskInfo(n,!!r.skipLayerImageData),a=n.children&&n.children.length,o=r.skipCompositeImageData&&(r.skipLayerImageData||a);return o||this.readImageData(n,i),n},t.prototype.readHeader=function(){this.checkSignature("8BPS");var e=this.readUint16();if(e!==1)throw new Error("Invalid PSD file version: "+e);this.skip(6);var r=this.readUint16(),n=this.readUint32(),i=this.readUint32(),a=this.readUint16(),o=this.readUint16();if(oe.indexOf(o)===-1)throw new Error("Color mode not supported: "+o);return{width:i,height:n,channels:r,bitsPerChannel:a,colorMode:o}},t.prototype.readColorModeData=function(e){this.readSection(1,function(){throw new Error("Not Implemented: color mode data")})},t.prototype.readImageResources=function(e){var r=this;this.readSection(1,function(n){for(;n();)r.readImageResource(e)})},t.prototype.readImageResource=function(e){var r=this;this.checkSignature("8BIM");var n=this.readUint16(),i=this.readPascalString();this.readSection(2,function(a){var o=ze.getHandler(n,i);e.imageResources||(e.imageResources={}),o?o.read(r,e.imageResources,a):r.skip(a())})},t.prototype.readLayerAndMaskInfo=function(e,r){var n=this,i=!1;return this.readSection(1,function(a){for(i=n.readLayerInfo(e,r),n.readGlobalLayerMaskInfo();a();)a()>2?n.readAdditionalLayerInfo(e):n.skip(a())}),i},t.prototype.readLayerInfo=function(e,r){var n=this,i=!1;return this.readSection(2,function(a){var o=n.readInt16();o<0&&(i=!0,o=-o);for(var s=[],f=[],l=0;l<o;l++){var d=n.readLayerRecord(),c=d.layer,u=d.channels;s.push(c),f.push(u)}if(!r)for(var l=0;l<o;l++)n.readLayerChannelImageData(e,s[l],f[l]);n.skip(a()),e.children||(e.children=[]);for(var h=[e],l=s.length-1;l>=0;l--){var v=s[l],y=v.sectionDivider?v.sectionDivider.type:w.SectionDividerType.Other;y===w.SectionDividerType.OpenFolder||y===w.SectionDividerType.ClosedFolder?(v.opened=y===w.SectionDividerType.OpenFolder,v.children=[],h[h.length-1].children.unshift(v),h.push(v)):y===w.SectionDividerType.BoundingSectionDivider?h.pop():h[h.length-1].children.unshift(v)}}),i},t.prototype.readLayerRecord=function(){var e=this,r={};r.top=this.readInt32(),r.left=this.readInt32(),r.bottom=this.readInt32(),r.right=this.readInt32();for(var n=this.readUint16(),i=[],a=0;a<n;a++){var o=this.readInt16(),s=this.readUint32();i.push({id:o,length:s})}this.checkSignature("8BIM");var f=this.readSignature();if(!w.toBlendMode[f])throw new Error("Invalid blend mode: '"+f+"'");r.blendMode=w.toBlendMode[f],r.opacity=this.readUint8(),r.clipping=this.readUint8()===1;var l=this.readUint8();return r.transparencyProtected=(l&1)!==0,r.hidden=(l&2)!==0,this.readUint8(),this.readSection(1,function(d){e.readLayerMaskData(),e.readLayerBlendingRanges(),r.name=e.readPascalString();for(var c=0;d()&&(c=e.readUint8())===0;);for(c!==0&&e.offset--;d()>4;)e.readAdditionalLayerInfo(r)}),{layer:r,channels:i}},t.prototype.readLayerMaskData=function(){this.readSection(1,function(e){if(e())throw new Error("Not Implemented: layer mask data")})},t.prototype.readLayerBlendingRanges=function(){var e=this;return this.readSection(1,function(r){for(var n=e.readUint32(),i=e.readUint32(),a=[];r();){var o=e.readUint32(),s=e.readUint32();a.push({sourceRange:o,destRange:s})}return{compositeGrayBlendSource:n,compositeGraphBlendDestinationRange:i,ranges:a}})},t.prototype.readLayerChannelImageData=function(e,r,n){var i=r.right-r.left,a=r.bottom-r.top,o,s,f;i&&a&&(o=this.createCanvas(i,a),s=o.getContext("2d"),f=s.createImageData(i,a),D.resetCanvas(f));for(var l=0,d=n;l<d.length;l++){var c=d[l],u=this.readUint16(),h=D.offsetForChannel(c.id);if(h<0)throw new Error("Channel not supported: "+c.id);if(u===w.Compression.RawData)D.readDataRaw(this,f,h,i,a);else if(u===w.Compression.RleCompressed)D.readDataRLE(this,f,4,i,a,[h]);else throw new Error("Compression type not supported: "+u);f&&e.colorMode===w.ColorMode.Grayscale&&se(f)}s&&f&&(s.putImageData(f,0,0),r.canvas=o)},t.prototype.readGlobalLayerMaskInfo=function(){var e=this;return this.readSection(1,function(r){if(r()){var n=e.readUint16(),i=e.readUint16(),a=e.readUint16(),o=e.readUint16(),s=e.readUint16(),f=e.readUint16(),l=e.readUint8();return e.skip(r()),{overlayColorSpace:n,colorSpace1:i,colorSpace2:a,colorSpace3:o,colorSpace4:s,opacity:f,kind:l}}})},t.prototype.readAdditionalLayerInfo=function(e){var r=this;this.checkSignature("8BIM","8B64");var n=this.readSignature();this.readSection(2,function(i){var a=Fe.getHandler(n);a?a.read(r,e,i):(console.log("Unhandled additional info: "+n),r.skip(i())),i()&&(console.log("Unread "+i()+" bytes left for tag: "+n),r.skip(i()))})},t.prototype.readImageData=function(e,r){var n=this.readUint16();if(oe.indexOf(e.colorMode)===-1)throw new Error("Color mode not supported: "+e.colorMode);if(n!==w.Compression.RawData&&n!==w.Compression.RleCompressed)throw new Error("Compression type not supported: "+n);var i=this.createCanvas(e.width,e.height),a=i.getContext("2d"),o=a.createImageData(e.width,e.height);if(D.resetCanvas(o),e.colorMode===w.ColorMode.Bitmap){var s=[];n===w.Compression.RawData?s=this.readBytes(Math.ceil(e.width/8)*e.height):n===w.Compression.RleCompressed&&D.readDataRLE(this,{data:s,width:e.width,height:e.height},1,e.width,e.height,[0]),D.decodeBitmap(s,o.data,e.width,e.height)}else{var f=e.colorMode===w.ColorMode.RGB?[0,1,2]:[0];if(e.channels&&e.channels>3)for(var l=3;l<e.channels;l++)f.push(l);else r&&f.push(3);if(n===w.Compression.RawData)for(var l=0;l<f.length;l++)D.readDataRaw(this,o,f[l],e.width,e.height);else n===w.Compression.RleCompressed&&D.readDataRLE(this,o,4,e.width,e.height,f);e.colorMode===w.ColorMode.Grayscale&&se(o)}a.putImageData(o,0,0),e.canvas=i},t}();H.PsdReader=je;var He=j&&j.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)i.hasOwnProperty(a)&&(n[a]=i[a])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Y,"__esModule",{value:!0});var Te=H,We=function(t){He(e,t);function e(r){var n=t.call(this)||this;return n.buffer=r,n.view=new DataView(n.buffer),n}return e.prototype.readInt8=function(){return this.offset+=1,this.view.getInt8(this.offset-1)},e.prototype.readUint8=function(){return this.offset+=1,this.view.getUint8(this.offset-1)},e.prototype.readInt16=function(){return this.offset+=2,this.view.getInt16(this.offset-2,!1)},e.prototype.readUint16=function(){return this.offset+=2,this.view.getUint16(this.offset-2,!1)},e.prototype.readInt32=function(){return this.offset+=4,this.view.getInt32(this.offset-4,!1)},e.prototype.readUint32=function(){return this.offset+=4,this.view.getUint32(this.offset-4,!1)},e.prototype.readFloat32=function(){return this.offset+=4,this.view.getFloat32(this.offset-4,!1)},e.prototype.readFloat64=function(){return this.offset+=8,this.view.getFloat64(this.offset-8,!1)},e.prototype.readBytes=function(r){return this.offset+=r,new Uint8Array(this.view.buffer,this.offset-r,r)},e.prototype.createCanvas=function(r,n){var i=document.createElement("canvas");return i.width=r,i.height=n,i},e}(Te.PsdReader);Y.ArrayBufferPsdReader=We;var J={},W={};Object.defineProperty(W,"__esModule",{value:!0});var A=_,q=g,$e=x,Ve=G;function ge(t,e){if(e)for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.children&&i.canvas)throw new Error("Invalid layer: cannot have both 'canvas' and 'children' properties set");i.children&&(i.sectionDivider={type:i.opened===!1?A.SectionDividerType.ClosedFolder:A.SectionDividerType.OpenFolder,key:"pass",subtype:0},t.push({name:"</Layer group>",sectionDivider:{type:A.SectionDividerType.BoundingSectionDivider}}),ge(t,i.children)),t.push(i)}}var M="Not implemented",Ze=function(){function t(){this.offset=0}return t.prototype.writeInt8=function(e){throw new Error(M)},t.prototype.writeUint8=function(e){throw new Error(M)},t.prototype.writeInt16=function(e){throw new Error(M)},t.prototype.writeUint16=function(e){throw new Error(M)},t.prototype.writeInt32=function(e){throw new Error(M)},t.prototype.writeUint32=function(e){throw new Error(M)},t.prototype.writeFloat32=function(e){throw new Error(M)},t.prototype.writeFloat64=function(e){throw new Error(M)},t.prototype.writeBytes=function(e){throw new Error(M)},t.prototype.writeBuffer=function(e){e&&this.writeBytes(new Uint8Array(e))},t.prototype.writeSignature=function(e){if(!e||e.length!==4)throw new Error("Invalid signature: '"+e+"'");for(var r=0;r<4;r++)this.writeUint8(e.charCodeAt(r))},t.prototype.writeZeros=function(e){for(var r=0;r<e;r++)this.writeUint8(0)},t.prototype.writePascalString=function(e,r){r===void 0&&(r=2);var n=e.length;this.writeUint8(n);for(var i=0;i<n;i++){var a=e.charCodeAt(i);this.writeUint8(a<128?a:"?".charCodeAt(0))}for(;++n%r;)this.writeUint8(0)},t.prototype.writeUnicodeString=function(e){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writeUint16(e.charCodeAt(r))},t.prototype.writeSection=function(e,r){var n=this.offset;this.writeUint32(0),r();for(var i=this.offset-n-4;i%e!==0;)this.writeUint8(0),i++;var a=this.offset;this.offset=n,this.writeUint32(i),this.offset=a},t.prototype.writePsd=function(e,r){if(!(+e.width>0&&+e.height>0))throw new Error("Invalid document size");var n=e.canvas,i=!!n&&q.hasAlpha(n.getContext("2d").getImageData(0,0,n.width,n.height));this.writeHeader(e,i),this.writeColorModeData(e),this.writeImageResources(e),this.writeLayerAndMaskInfo(e,i),this.writeImageData(e,i)},t.prototype.writeHeader=function(e,r){this.writeSignature("8BPS"),this.writeUint16(1),this.writeZeros(6),this.writeUint16(r?4:3),this.writeUint32(e.height),this.writeUint32(e.width),this.writeUint16(8),this.writeUint16(A.ColorMode.RGB)},t.prototype.writeColorModeData=function(e){this.writeSection(1,function(){})},t.prototype.writeImageResources=function(e){var r=this;this.writeSection(1,function(){var n=e.imageResources;if(n)for(var i=function(f){f.has(n)&&(r.writeSignature("8BIM"),r.writeUint16(f.key),r.writePascalString(""),r.writeSection(2,function(){return f.write(r,n)}))},a=0,o=Ve.getHandlers();a<o.length;a++){var s=o[a];i(s)}})},t.prototype.writeLayerAndMaskInfo=function(e,r){var n=this;this.writeSection(2,function(){n.writeLayerInfo(e,r),n.writeGlobalLayerMaskInfo(),n.writeAdditionalLayerInfo(e)})},t.prototype.writeLayerInfo=function(e,r){var n=this;this.writeSection(2,function(){var i=[];ge(i,e.children),i.length||i.push({});var a=i.map(function(o,s){return q.getChannels(o,s===0)});n.writeInt16(r?-i.length:i.length),i.forEach(function(o,s){return n.writeLayerRecord(e,o,a[s])}),a.forEach(function(o){return n.writeLayerChannelImageData(o)})})},t.prototype.writeLayerRecord=function(e,r,n){var i=this;this.writeUint32(r.top||0),this.writeUint32(r.left||0),this.writeUint32(r.bottom||0),this.writeUint32(r.right||0),this.writeUint16(n.length);for(var a=0,o=n;a<o.length;a++){var s=o[a];this.writeInt16(s.channelId),this.writeUint32(s.length)}this.writeSignature("8BIM"),this.writeSignature(A.fromBlendMode[r.blendMode||"normal"]),this.writeUint8(typeof r.opacity<"u"?r.opacity:255),this.writeUint8(r.clipping?1:0);var f=0;r.transparencyProtected&&(f=f|1),r.hidden&&(f=f|2),this.writeUint8(f),this.writeUint8(0),this.writeSection(1,function(){i.writeLayerMaskData(),i.writeLayerBlendingRanges(e),i.writePascalString(r.name||"",4),i.writeAdditionalLayerInfo(r)})},t.prototype.writeLayerMaskData=function(){this.writeSection(1,function(){})},t.prototype.writeLayerBlendingRanges=function(e){var r=this;this.writeSection(1,function(){r.writeUint32(65535),r.writeUint32(65535);for(var n=e.channels||0,i=0;i<n;i++)r.writeUint32(65535),r.writeUint32(65535)})},t.prototype.writeLayerChannelImageData=function(e){for(var r=0,n=e;r<n.length;r++){var i=n[r];this.writeUint16(i.compression),i.buffer&&this.writeBuffer(i.buffer)}},t.prototype.writeGlobalLayerMaskInfo=function(){this.writeSection(1,function(){})},t.prototype.writeAdditionalLayerInfo=function(e){for(var r=this,n=function(f){f.has(e)&&(i.writeSignature("8BIM"),i.writeSignature(f.key),i.writeSection(2,function(){return f.write(r,e)}))},i=this,a=0,o=$e.getHandlers();a<o.length;a++){var s=o[a];n(s)}},t.prototype.writeImageData=function(e,r){var n=r?[0,1,2,3]:[0,1,2],i;e.canvas?i=e.canvas.getContext("2d").getImageData(0,0,e.width,e.height):i={data:new Uint8Array(4*e.width*e.height),width:e.width,height:e.height},this.writeUint16(A.Compression.RleCompressed),this.writeBytes(q.writeDataRLE(i,e.width,e.height,n))},t}();W.PsdWriter=Ze;var Ke=j&&j.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)i.hasOwnProperty(a)&&(n[a]=i[a])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(J,"__esModule",{value:!0});var qe=W,Ye=function(t){Ke(e,t);function e(r){r===void 0&&(r=1024);var n=t.call(this)||this;return n.buffer=new ArrayBuffer(r),n.view=new DataView(n.buffer),n}return e.prototype.ensureSize=function(r){if(r>this.buffer.byteLength){var n=this.buffer.byteLength;do n*=2;while(r>n);var i=new ArrayBuffer(n),a=new Uint8Array(i),o=new Uint8Array(this.buffer);a.set(o),this.buffer=i,this.view=new DataView(this.buffer)}},e.prototype.addSize=function(r){var n=this.offset;return this.ensureSize(this.offset+=r),n},e.prototype.writeInt8=function(r){var n=this.addSize(1);this.view.setInt8(n,r)},e.prototype.writeUint8=function(r){var n=this.addSize(1);this.view.setUint8(n,r)},e.prototype.writeInt16=function(r){var n=this.addSize(2);this.view.setInt16(n,r,!1)},e.prototype.writeUint16=function(r){var n=this.addSize(2);this.view.setUint16(n,r,!1)},e.prototype.writeInt32=function(r){var n=this.addSize(4);this.view.setInt32(n,r,!1)},e.prototype.writeUint32=function(r){var n=this.addSize(4);this.view.setUint32(n,r,!1)},e.prototype.writeFloat32=function(r){var n=this.addSize(4);this.view.setFloat32(n,r,!1)},e.prototype.writeFloat64=function(r){var n=this.addSize(8);this.view.setFloat64(n,r,!1)},e.prototype.writeBytes=function(r){if(r){this.ensureSize(this.offset+r.length);var n=new Uint8Array(this.buffer);n.set(r,this.offset),this.offset+=r.length}},e.prototype.getBuffer=function(){return this.buffer.slice(0,this.offset)},e}(qe.PsdWriter);J.ArrayBufferPsdWriter=Ye;(function(t){function e(f){for(var l in f)t.hasOwnProperty(l)||(t[l]=f[l])}Object.defineProperty(t,"__esModule",{value:!0});var r=Y,n=J;e(_);var i=H;t.PsdReader=i.PsdReader;var a=W;t.PsdWriter=a.PsdWriter;function o(f,l){var d=new r.ArrayBufferPsdReader(f);return d.readPsd(l)}t.readPsd=o;function s(f,l){var d=new n.ArrayBufferPsdWriter;return d.writePsd(f,l),d.getBuffer()}t.writePsd=s})(fe);const me=Ue(fe);class Je{constructor(e){this.config=e,this.psd=null,this.layerCache=new Map}async loadPSD(e){try{const n=await(await fetch(e)).arrayBuffer();return this.psd=me.readPsd(n),this.buildLayerCache(this.psd.children),this.psd}catch(r){throw console.error("Ошибка загрузки PSD:",r),r}}buildLayerCache(e,r=""){e.forEach(n=>{const i=r?`${r}/${n.name}`:n.name;n.children?this.buildLayerCache(n.children,i):this.layerCache.set(i,n)})}render(e,r,n,i){if(!r)return;const a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),this.config.defaultRenderOrder.forEach(o=>{n[o]&&this.renderPart(a,n[o],i)})}renderPart(e,r,n){r.layers.forEach(i=>{const a=this.layerCache.get(i);if(!a)return;const o=document.createElement("canvas");o.width=a.width,o.height=a.height;const s=o.getContext("2d");this.drawLayer(s,a,r,n),e.drawImage(o,0,0,a.width,a.height,0,0,e.canvas.width,e.canvas.height)})}drawLayer(e,r,n,i){const a=n.colorable;let o=!1,s=null;if(typeof a=="string"&&r.name.includes(a))o=!0,s=a==="[красить]"?n.colorable:"eyesWhite";else if(typeof a=="object"){for(const[f,l]of Object.entries(a))if(r.name.includes(f)){o=!0,s=l;break}}o&&s&&i[s]?this.applyColorToLayer(e,r,i[s]):this.drawLayerImage(e,r)}applyColorToLayer(e,r,n){const i=document.createElement("canvas");i.width=r.width,i.height=r.height;const a=i.getContext("2d");this.drawLayerImage(a,r),e.fillStyle=n,e.fillRect(0,0,r.width,r.height),e.globalCompositeOperation="multiply",e.drawImage(i,0,0),e.globalCompositeOperation="source-over"}drawLayerImage(e,r){if(r.imageData)try{const n=new ImageData(new Uint8ClampedArray(r.imageData),r.width,r.height);e.putImageData(n,0,0)}catch(n){console.error("Error drawing layer:",r.name,n)}}}class Xe{constructor(e){this.config=e}async exportToPNG(e,r,n){return new Promise(i=>{e.toBlob(a=>{i(a)},"image/png",1)})}async exportToPSD(e,r,n,i,a){const o=this.clonePSD(e);this.cleanPSD(o,r),this.applyColorsToPSD(o,r,n);const s=me.writePsd(o,{width:i,height:a,generateThumbnail:!0});return new Blob([s],{type:"application/octet-stream"})}clonePSD(e){return JSON.parse(JSON.stringify(e))}cleanPSD(e,r){const n=this.getAllActiveLayers(r),i=a=>a.filter(o=>o.children?(o.children=i(o.children),o.children.length>0):n.some(s=>s.includes(o.name)));e.children=i(e.children)}getAllActiveLayers(e){return Object.values(e).flatMap(r=>r.layers).map(r=>r.split("/").pop())}applyColorsToPSD(e,r,n){const i=(o,s,f)=>{const l=s.colorable;let d=!1,c=null;if(typeof l=="string"&&o.name.includes(l))d=!0,c=l==="[красить]"?s.colorable:"eyesWhite";else if(typeof l=="object"){for(const[u,h]of Object.entries(l))if(o.name.includes(u)){d=!0,c=h;break}}d&&c&&f[c]&&this.colorizeLayer(o,f[c])},a=o=>{o.forEach(s=>{if(s.children)a(s.children);else for(const f of Object.values(r))if(f.layers.some(l=>l.includes(s.name))){i(s,f,n);break}})};a(e.children)}colorizeLayer(e,r){if(!e.imageData)return;const n=this.hexToRgb(r);if(!n)return;const i=e.imageData;for(let a=0;a<i.length;a+=4)if(i[a+3]>0){const o=i[a+3]/255;i[a]=Math.round(n.r*o),i[a+1]=Math.round(n.g*o),i[a+2]=Math.round(n.b*o)}}hexToRgb(e){const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null}}const m={canvasSettings:{width:315,height:315,backgroundColor:"#f5f5f5"},parts:{ears:{title:"Уши",enabled:!0,variants:{default_ears:{label:"Торчком обычные",layers:["Уши/торчком обычные/лайн","Уши/торчком обычные/свет","Уши/торчком обычные/тень","Уши/торчком обычные/[красить]"],colorable:"[красить]"},fluffy_ears:{label:"Торчком пушистые",layers:["Уши/торчком пушистые/лайн","Уши/торчком пушистые/свет","Уши/торчком пушистые/тень","Уши/торчком пушистые/[красить]"],colorable:"[красить]"},long_ears:{label:"Длинные",layers:["Уши/длинные/лайн","Уши/длинные/свет","Уши/длинные/тень","Уши/длинные/[красить]"],colorable:"[красить]"},hang_ears:{label:"Висячие",layers:["Уши/повисшие/лайн","Уши/повисшие/свет","Уши/повисшие/тень","Уши/повисшие/[красить]"],colorable:"[красить]"}}},eyes:{title:"Глаза",enabled:!0,variants:{foxy_eyes:{label:"Лисьи",layers:["Глаза/лисьи/блики","Глаза/лисьи/лайн","Глаза/лисьи/свет","Глаза/лисьи/тень","Глаза/лисьи/[красить]"],colorable:"[красить]"},default_eyes:{label:"Обычные",layers:["Глаза/обычные/блики","Глаза/обычные/свет","Глаза/обычные/тень","Глаза/обычные/[красить]","Глаза/обычные/[белок красить]"],colorable:{"[красить]":"eyes","[белок красить]":"eyesWhite"}}}},lashes:{title:"Ресницы",enabled:!0,dependsOn:{part:"eyes",variant:"default_eyes"},variants:{on_lashes:{label:"Включены",layers:["Глаза/обычные/с ресницами"],colorable:null},off_lashes:{label:"Выключены",layers:["Глаза/обычные/без ресниц"],colorable:null}}},cheeks:{title:"Щёки",enabled:!0,variants:{fluffy_cheeks:{label:"Пушистые",layers:["Щёки/пушистые/лайн","Щёки/пушистые/тень","Щёки/пушистые/свет","Щёки/пушистые/[красить]"],colorable:"[красить]"},off_cheeks:{label:"Выключены",layers:[],colorable:null,hideInUI:!0}}},head:{title:"Голова",enabled:!0,isSingleVariant:!0,variant:{label:"Обычная",layers:["Голова/лайн","Голова/свет","Голова/тень","Голова/[красить]"],colorable:"[красить]"}},mane:{title:"Грудь | Шея | Грива",enabled:!0,variants:{default_mane:{label:"Обычная",layers:["Грудь Шея Грива/обычная/лайн","Грудь Шея Грива/обычная/свет","Грудь Шея Грива/обычная/тень","Грудь Шея Грива/обычная/[красить]"],colorable:"[красить]"},fluffy_mane:{label:"Пышная",layers:["Грудь Шея Грива/пышная/лайн","Грудь Шея Грива/пышная/свет","Грудь Шея Грива/пышная/тень","Грудь Шея Грива/пышная/[красить]"],colorable:"[красить]"},short_mane:{label:"Короткошёрстная",layers:["Грудь Шея Грива/короткошерстная/лайн","Грудь Шея Грива/короткошерстная/свет","Грудь Шея Грива/короткошерстная/тень","Грудь Шея Грива/короткошерстная/[красить]"],colorable:"[красить]"}}},body:{title:"Тело",enabled:!0,variants:{default_body:{label:"Обычное",layers:["Тело/v1/лайн","Тело/v1/тень","Тело/v1/свет","Тело/v1/свет2","Тело/v1/[красить]"],colorable:"[красить]"},short_body:{label:"Короткошёрстное",layers:["Тело/v2/лайн","Тело/v2/тень","Тело/v2/свет","Тело/v2/свет2","Тело/v2/[красить]"],colorable:"[красить]"},fluffy_body:{label:"Пушистое",layers:["Тело/v3/лайн","Тело/v3/тень","Тело/v3/свет","Тело/v3/свет2","Тело/v3/[красить]"],colorable:"[красить]"}}},tail:{title:"Хвост",enabled:!0,variants:{default_tail:{label:"Обычный",layers:["Хвосты/обычный/лайн","Хвосты/обычный/свет","Хвосты/обычный/тень","Хвосты/обычный/[красить]"],colorable:"[красить]"},"long-thin_tail":{label:"Длинный тонкий",layers:["Хвосты/длинный тонкий/лайн","Хвосты/длинный тонкий/свет","Хвосты/длинный тонкий/тень","Хвосты/длинный тонкий/[красить]"],colorable:"[красить]"},short_tail:{label:"Куцый",layers:["Хвосты/куцый/лайн","Хвосты/куцый/свет","Хвосты/куцый/тень","Хвосты/куцый/[красить]"],colorable:"[красить]"},fluffy_tail:{label:"Пышный",layers:["Хвосты/пышный/лайн","Хвосты/пышный/свет","Хвосты/пышный/тень","Хвосты/пышный/[красить]"],colorable:"[красить]"}}}},colors:{ears:{default:"#f1ece4"},eyes:{default:"#f1ece4"},cheeks:{default:"#f1ece4"},head:{default:"#f1ece4"},mane:{default:"#f1ece4"},body:{default:"#f1ece4"},tail:{default:"#f1ece4"},main:{default:"#f1ece4",affects:["ears","cheeks","head","mane","body","tail"]},eyesWhite:{default:"#ffffff",layerMarker:"[белок красить]"}},defaultRenderOrder:["tail","body","mane","head","cheeks","eyes","ears"]};class Qe{constructor(){this.state={activeParts:{},colors:{},psdData:null},this.renderEngine=new Je(m),this.exportEngine=new Xe(m),this.ui={previewCanvas:document.getElementById("preview-canvas"),partsContainer:document.getElementById("parts-container"),colorPickers:{}},this.init()}async init(){await this.loadPSD(),this.initDefaultState(),this.render(),this.initUI()}async loadPSD(){this.state.psdData=await this.renderEngine.loadPSD("assets/model.psd")}initDefaultState(){Object.keys(m.parts).forEach(e=>{const r=m.parts[e];if(r.isSingleVariant)this.state.activeParts[e]=r.variant;else{const n=Object.keys(r.variants)[0];this.state.activeParts[e]=r.variants[n]}}),Object.keys(m.colors).forEach(e=>{this.state.colors[e]=m.colors[e].default})}render(){this.renderEngine.render(this.ui.previewCanvas,this.state.psdData,this.state.activeParts,this.state.colors)}initUI(){this.initPartsUI(),this.initColorPickers(),this.initExportButtons()}setPartVariant(e,r){this.state.activeParts[e]=m.parts[e].variants[r],this.render()}setColor(e,r){this.state.colors[e]=r,e==="main"&&m.colors.main.affects.forEach(n=>{this.state.colors[n]=r}),this.render()}async exportPNG(){return this.exportEngine.exportToPNG(this.ui.previewCanvas,m.canvasSettings.width,m.canvasSettings.height)}async exportPSD(){return this.exportEngine.exportToPSD(this.state.psdData,this.state.activeParts,this.state.colors,m.canvasSettings.width,m.canvasSettings.height)}initPartsUI(){const e=this.ui.partsContainer;e.innerHTML="",Object.entries(m.parts).forEach(([r,n])=>{if(n.dependsOn){const o=this.state.activeParts[n.dependsOn.part];if(!o||o!==n.dependsOn.variant)return}if(n.variants&&Object.values(n.variants)[0].hideInUI)return;const i=document.createElement("div");i.className="part-container";const a=document.createElement("h3");if(a.textContent=n.title,i.appendChild(a),n.variants&&!n.isSingleVariant){const o=document.createElement("div");o.className="variants-container",Object.entries(n.variants).forEach(([s,f])=>{if(f.hideInUI)return;const l=document.createElement("button");l.className="variant-button",this.state.activeParts[r]===f&&l.classList.add("active"),l.textContent=f.label,l.addEventListener("click",()=>{this.setPartVariant(r,s),o.querySelectorAll(".variant-button").forEach(d=>{d.classList.remove("active")}),l.classList.add("active")}),o.appendChild(l)}),i.appendChild(o)}e.appendChild(i)})}initColorPickers(){Object.entries(m.colors).forEach(([e,r])=>{e==="main"?this.createColorPicker(e,r,!0):r.layerMarker||this.createColorPicker(e,r)})}createColorPicker(e,r,n=!1){let i=null;if(n){i=document.createElement("div"),i.className="part-container";const l=document.createElement("h3");l.textContent="Основной цвет",i.appendChild(l),this.ui.partsContainer.prepend(i)}else{const l=e;if(i=Array.from(document.querySelectorAll(".part-container")).find(d=>{var c,u;return((c=d.querySelector("h3"))==null?void 0:c.textContent)===((u=m.parts[l])==null?void 0:u.title)}),!i)return}const a=document.createElement("div");a.className="color-picker-container";const o=document.createElement("span");o.textContent=n?"Основной цвет:":"Цвет:",a.appendChild(o);const s=document.createElement("input");s.type="color",s.value=this.state.colors[e]||r.default,s.addEventListener("input",l=>{this.setColor(e,l.target.value)});const f=document.createElement("input");f.type="text",f.value=this.state.colors[e]||r.default,f.placeholder="HEX цвет",f.addEventListener("change",l=>{/^#[0-9A-F]{6}$/i.test(l.target.value)&&(this.setColor(e,l.target.value),s.value=l.target.value)}),a.appendChild(s),a.appendChild(f),i.appendChild(a),this.ui.colorPickers[e]={colorInput:s,hexInput:f}}initExportButtons(){document.getElementById("export-png").addEventListener("click",async()=>{const e=await this.exportPNG();this.downloadBlob(e,"character.png")}),document.getElementById("export-psd").addEventListener("click",async()=>{const e=await this.exportPSD();this.downloadBlob(e,"character.psd")})}downloadBlob(e,r){const n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}}document.addEventListener("DOMContentLoaded",()=>{new Qe});
